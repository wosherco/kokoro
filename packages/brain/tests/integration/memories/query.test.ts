import { db } from "@kokoro/db/client";
import {
  calendarTable,
  integrationsAccountsTable,
  memoryEventTable,
  memoryTable,
  memoryTaskTable,
  tasklistsTable,
  userTable,
} from "@kokoro/db/schema";
import { GOOGLE_CALENDAR, LINEAR_INTEGRATION } from "@kokoro/validators/db";
import type { StartedPostgreSqlContainer } from "@testcontainers/postgresql";
import { afterAll, beforeAll, describe, expect, it, vi } from "vitest";
import { getMemories } from "../../../src/memories/query";
import { createDatabaseContainer } from "../containers";

const userId = crypto.randomUUID();

describe("querying memories", () => {
  let databaseContainer: StartedPostgreSqlContainer | undefined;

  beforeAll(async () => {
    const { postgresContainer, uri } = await createDatabaseContainer();
    databaseContainer = postgresContainer;

    vi.doMock("../../env", () => ({
      env: {
        POSTGRES_URL: uri,
      },
    }));

    // Insert user
    await db.insert(userTable).values({
      id: userId,
      email: "test@test.com",
      name: "Test User",
    });

    // Insert calendar integration
    const calendarIntegrationId = crypto.randomUUID();
    const calendarPlatformAccountId = crypto.randomUUID();
    await db.insert(integrationsAccountsTable).values({
      id: calendarIntegrationId,
      userId,
      integrationType: GOOGLE_CALENDAR,
      platformAccountId: calendarPlatformAccountId,
      email: "test@test.com",
      platformDisplayName: "Test Integration",
      platformData: {
        syncToken: "test",
        lastSynced: new Date().toISOString(),
      },
      accessToken: "test",
      refreshToken: "test",
      expiresAt: new Date(),
    });

    // Insert calendar to calendar integration
    const calendarId = crypto.randomUUID();
    const calendarPlatformId = crypto.randomUUID();
    await db.insert(calendarTable).values({
      id: calendarId,
      userId,
      source: GOOGLE_CALENDAR,
      integrationAccountId: calendarIntegrationId,
      summary: "Test Calendar",
      platformAccountId: calendarPlatformAccountId,
      platformCalendarId: calendarPlatformId,
      platformData: {
        primary: true,
        accessRole: "owner",
      },
      eventsSyncToken: "test",
    });

    // Insert calendar event memory
    const eventMemoryId = crypto.randomUUID();
    const eventMemoryEventId = crypto.randomUUID();
    const eventPlatformId = crypto.randomUUID();
    await db.insert(memoryTable).values({
      id: eventMemoryId,
      userId,
      source: "CALENDAR",
      content: "Dentist appointment",
      contentEmbedding: [
        -0.06650842, 0.021423653, -0.034474738, -0.0151417665, -0.16177753,
        -0.055608753, -0.045113284, 0.025685329, 0.015187136, 0.0050837887,
        -0.05733368, -0.04168272, -0.059183378, 0.04591207, -0.041174676,
        0.013384512, 0.025305381, -0.017960662, 0.057088483, 0.009326397,
        -0.008700406, 0.05269312, -0.024290837, -0.028421594, -0.017362868,
        0.063244015, -0.00916279, -0.083132766, 0.068817616, 0.06664006,
        0.0015190602, -0.015059734, 0.082522, -0.055128712, 0.06007443,
        0.020643344, -0.040282693, 0.028044226, 0.021342613, 0.019352898,
        -0.047488887, 0.023803493, -0.001628428, 0.0044489386, 0.020414086,
        -0.016859861, 0.03513812, -0.014985152, 0.0054206494, -0.039700184,
        0.0075887, -0.048090115, -0.015074614, -0.034309067, -0.079062514,
        0.06806256, 0.01082802, -0.05672844, -0.002541745, 0.069708765,
        -0.009207849, -0.011101944, -0.048728302, 0.14034697, -0.08202345,
        0.09041608, 0.026749687, -0.057147525, 0.03592717, -0.022741763,
        -0.05492207, -0.004178924, 0.07713298, 0.031179663, 0.058025155,
        -0.06800423, 0.1133794, 0.0072682067, 0.01743733, 0.023383465,
        -0.028566342, -0.016833158, 0.022710167, 0.03576176, 0.028492166,
        -0.029551461, -0.038535055, 0.016481666, -0.037419397, -0.055030853,
        0.049699374, 0.040195376, -0.050847992, 0.026212713, -0.0013083261,
        0.05031787, -0.0016957031, 0.06490846, 0.025510162, 0.15593281,
        -0.00016918269, 0.029626813, -0.074637845, 0.053888462, -0.022255084,
        -0.03916081, -0.10313272, -0.09071036, -0.007358809, -0.025074255,
        0.020993894, 0.015620694, 0.05719409, -0.030938873, -0.065029375,
        0.017125363, 0.0061015473, 0.01894048, 0.0326577, 0.0803597,
        -0.023499342, -0.0030764989, -0.04791586, -0.05245525, 0.03930853,
        -0.031555947, 0.06460385, -4.0638394e-33, 0.035124145, -0.046773244,
        0.0077510453, -0.07221288, 0.043017235, 0.046867985, -0.016470743,
        0.024973756, -0.019418787, -0.00650337, 0.038285535, -0.001263981,
        0.017540202, -0.072809644, -0.13825884, 0.08949177, -0.010169569,
        0.08880399, -0.062787704, 0.061517965, -0.060166094, -0.10108353,
        -0.05215925, 0.13497294, -0.014423624, 0.055760007, 0.014159353,
        -0.076351605, 0.08888522, 0.003079666, -0.07226775, 0.012073628,
        0.039038334, -0.045422614, 0.06557664, 0.051910408, 0.025517048,
        0.0027389147, -0.028999291, -0.061903976, 0.0368484, 0.059805237,
        -0.00517939, 0.017411487, 0.056184076, 0.005165714, 0.012729798,
        0.08397917, 0.06914494, 0.020623408, -0.050018553, -0.04493176,
        -0.059199646, 0.07778046, -0.051568743, 0.015643045, 0.05588566,
        -0.0022787359, 0.036383886, 0.020556638, 0.021166658, -0.008048534,
        -0.006050469, 0.015069496, -0.06926613, -0.08668634, -0.0270773,
        -0.05292049, 0.049895298, -0.03060543, -0.045167185, 0.058231443,
        -0.0431665, 0.0017123962, -0.077240966, 0.040789276, 0.107255705,
        0.06435526, -0.049757436, 0.02461327, 0.041409988, -0.0048758206,
        0.012749836, -0.014494647, 0.03574436, 0.027704373, -0.058343023,
        -0.033701077, 0.038920224, 0.010701966, -0.09905276, -0.031293433,
        0.015166077, 0.015080246, 0.021051403, 2.0544883e-33, 0.04195794,
        -0.03131931, -0.030169858, 0.03346103, 0.03559248, 0.019971494,
        -0.039819088, 0.003017345, 0.0020690034, 0.0020701026, 0.0009530109,
        0.1198358, 0.12322539, -0.061248604, -0.0039493307, 0.057169802,
        0.04501401, -0.01627484, -0.062366743, 0.063032895, -0.013684839,
        0.05966662, 0.021347951, -0.07686826, -0.068908244, 0.03387148,
        0.0062534763, -0.047033846, -0.06006327, -0.016983086, -0.078034654,
        -0.041458078, -0.08569277, 0.055738147, -0.049449194, 0.12469682,
        -0.006775708, -0.026154278, -0.076029785, 0.058895633, 0.02154523,
        -0.013400389, 0.0067387694, 0.07307744, 0.004108105, 0.050962,
        0.032305524, 0.008798848, -0.029803157, 0.020462278, -0.09869846,
        0.04431473, -0.040632814, 0.0699267, -0.019732561, 0.013614268,
        -0.041468523, -0.07003577, -0.00636209, 0.026401408, 0.030152978,
        -0.023587957, -0.0010919307, -0.0013779972, -0.037867058, -0.03156976,
        0.023484468, -0.011632199, 0.026860569, 0.08149811, -0.06439101,
        0.006265359, -0.0075296103, -0.039722193, 0.014398697, 0.0041510435,
        0.04285075, -0.10078572, -0.06493107, -0.04581927, -0.07757056,
        0.020471202, 0.020866642, 0.065769315, -0.07338259, -0.031102713,
        0.08573986, -0.030947424, 0.0010304024, 0.01056255, -0.011331654,
        0.096751034, 0.0009687871, -0.06447877, 0.07425402, -1.15360725e-8,
        -0.02426618, -0.0022476027, 0.002391358, -0.026954217, 0.026991528,
        -0.21754083, -0.06682626, 0.021113763, -0.039678454, 0.053579178,
        0.068512395, 0.024679178, -0.03209114, -0.022259697, 0.024083484,
        0.03137541, 0.04291126, -0.027076917, -0.053339556, -0.04628663,
        -0.11170944, -0.030300187, 0.08516425, 0.009255676, 0.039924778,
        -0.025034247, -0.016443301, 0.093534306, -0.011773629, 0.045184538,
        -0.05921621, 0.093439, 0.00091663847, -0.039819214, -0.0023826575,
        -0.093755655, -0.02673565, -0.0007542382, 0.012594485, -0.005466649,
        0.0010782934, -0.035111282, 0.0050104344, 0.07568477, -0.08006789,
        0.021545557, 0.08472442, 0.043376114, 0.052610338, 0.027874364,
        -0.03296393, -0.010125722, 0.04637041, -0.051404566, -0.013895759,
        0.075264215, 0.08708815, -0.05664632, 0.0067338166, 0.058727715,
        -0.054617114, 0.0047619236, -0.02544459, -0.042369813,
      ],
      description:
        "Dentist appointment to get out my wisdom teeth of below right corner",
      descriptionEmbedding: [
        -0.025537774, 0.07303564, -0.03781451, 0.046902444, -0.06361533,
        -0.022621967, -0.0476013, 0.027348675, 0.0105978325, -0.041862786,
        -0.049149588, 0.019289576, -0.007254376, 0.0059766388, -0.03464064,
        -0.01623067, 0.017211458, -0.030801218, 0.0632386, 0.008111886,
        -0.026065933, 0.051234655, -0.028517216, -0.0036414282, -0.059350196,
        0.05649883, -0.03336149, -0.0622719, 0.05684158, 0.08330109, 0.03646177,
        -0.048765894, 0.031716082, -0.07553745, 0.08086841, -0.018197427,
        -0.06196832, 0.017614562, 0.026843574, 0.033972267, -0.021210577,
        0.036696196, -0.01761513, 0.024875125, 0.051591903, 0.059569065,
        -0.06302602, -0.029266262, 0.045590263, 0.0020163793, 0.019064026,
        -0.011468549, -0.075898275, 0.07552792, -0.08385896, 0.050054543,
        -0.027597206, -0.029749308, 0.025788, 0.07661209, 0.043677367,
        -0.018047476, -0.009466158, 0.10640495, -0.13344401, 0.08222821,
        0.049895667, -0.0564191, -0.002537631, -0.060881358, -0.033644233,
        -0.044660896, 0.09372492, -0.068589196, 0.053432927, -0.07389017,
        0.11423072, -0.012131794, -0.050095703, 0.009849596, -0.046828557,
        0.065598026, 0.02020489, 0.026583267, -0.048743904, -0.07505297,
        -0.009276426, 0.042310134, 0.033618893, -0.010023288, 0.008199261,
        0.045645837, -0.037843257, 0.051819913, 0.07707932, -0.008830821,
        0.004209953, -0.02355001, -0.024276627, 0.046102945, 0.011641004,
        -0.0054305387, -0.063439414, -0.031147353, 0.053015668, 0.014703947,
        -0.09094534, -0.061884884, 0.0028428333, -0.020234672, 0.05779842,
        0.048578907, 0.10440368, 0.010425656, -0.0133645525, -0.030040221,
        0.020487376, 0.085424446, 0.034643993, 0.05457399, -0.032764003,
        0.014651422, -0.02205763, -0.015542023, 0.04937104, -0.009775407,
        0.002954061, -1.4760264e-33, 0.03150738, -0.016110474, -0.036693294,
        -0.05443026, 0.051299687, 0.0002631516, -0.047502823, -0.017003505,
        -0.008275632, 0.05297916, -0.005150355, -0.06339981, 0.031571057,
        -0.08437125, -0.09613046, 0.07200384, -0.022642195, 0.08215053,
        -0.105750084, 0.063063875, -0.04130474, -0.10753769, -0.066730514,
        0.061742596, -0.035484377, 0.10177019, -0.00006402631, -0.093587175,
        0.030359797, -0.015446307, -0.04452327, 0.00058530207, 0.11208413,
        -0.07673444, 0.054136027, 0.032857705, -0.017574405, -0.022528343,
        0.004007362, -0.039102614, -0.00021497381, 0.06870747, 0.010276962,
        0.029265337, 0.045896087, -0.013774268, 0.05115661, 0.091303125,
        0.0720917, -0.11994891, -0.094560996, -0.030692436, -0.02658601,
        0.029757483, -0.046644527, -0.013884293, 0.0361002, 0.060389083,
        0.07911731, 0.025650565, -0.014294179, 0.016605496, -0.019878063,
        -0.06274061, -0.0063439747, -0.13636611, -0.09225409, -0.003398545,
        -0.0071401116, -0.034853287, 0.0143636465, 0.088626735, -0.006645957,
        0.013703017, -0.071681865, 0.076763384, 0.0746016, 0.010626829,
        -0.011658158, -0.003123992, 0.01735002, 0.013422492, 0.0069114305,
        -0.03247533, 0.102602184, 0.0088448515, -0.053594176, -0.044928707,
        0.012414807, -0.007541756, -0.115841575, -0.020605553, -0.002400315,
        -0.055370145, -0.015273382, -2.8869064e-34, 0.0317204, -0.01388305,
        -0.004616799, -0.020437919, 0.06324841, 0.018513126, -0.033094797,
        0.107766874, -0.0046338225, 0.026488137, -0.06592708, 0.13014334,
        0.05914017, -0.068005055, 0.033846807, 0.052268483, 0.054055568,
        -0.0017268907, -0.10156284, 0.032515153, -0.008796095, 0.04554431,
        -0.014963379, -0.03390072, -0.06556811, 0.043077562, 0.03664553,
        0.03486751, -0.06318408, 0.0389153, -0.10971305, -0.067002304,
        -0.075593725, 0.037598953, -0.038455762, 0.08551509, -0.016898938,
        -0.08607709, -0.10033082, 0.02357561, 0.0049066558, 0.05577779,
        -0.019821698, 0.02029254, -0.015352245, 0.06493425, 0.041503645,
        0.011912942, -0.033474162, 0.02997868, -0.059691157, 0.036651816,
        -0.027062353, 0.04273829, -0.038019914, -0.047552872, -0.023405397,
        -0.07091921, -0.0016846019, -0.029378885, 0.037403096, 0.03443288,
        -0.014602723, 0.0074176495, 0.015190666, 0.03156022, 0.056651417,
        0.04018617, -0.053776793, -0.007993805, -0.0540613, 0.008982026,
        0.007882232, -0.09280308, 0.061008338, 0.04903048, 0.093214594,
        -0.09812733, -0.012027328, -0.05800665, -0.01532158, 0.0040153316,
        0.031274963, 0.00816279, 0.0061244597, -0.025000641, 0.01931179,
        -0.03474696, -0.037195012, 0.0024644143, -0.0036569135, 0.098508455,
        0.055326372, 0.0083581135, 0.08419063, -1.8393768e-8, -0.03321107,
        -0.0073413667, -0.04081086, 0.033936117, -0.03190821, -0.1492863,
        -0.09216155, 0.062260028, -0.0582393, -0.033062387, 0.025735818,
        -0.016873067, -0.015225333, -0.04056059, -0.025053162, 0.039043196,
        -0.028835304, -0.023355603, -0.011310666, -0.03759174, -0.08154654,
        -0.07253703, 0.07343322, -0.014258229, 0.009033082, 0.017858872,
        -0.01857458, 0.09821375, 0.028372427, 0.04364558, -0.046484217,
        0.065898694, 0.03435411, -0.01258498, 0.028034434, -0.040111765,
        -0.053334855, 0.03378003, 0.04709668, 0.008145829, -0.013346388,
        -0.017569067, 0.013013161, 0.114884466, -0.092483334, -0.0004968867,
        0.06833614, 0.08865072, 0.03423232, 0.024803909, 0.006072312,
        -0.05542352, 0.064413235, -0.020009153, -0.005184023, 0.02474179,
        0.04459183, -0.06590908, -0.046554603, 0.046402484, -0.10283576,
        0.0257154, -0.018993285, -0.03396113,
      ],
      createdAt: new Date(),
      lastUpdate: new Date(),
    });
    await db.insert(memoryEventTable).values({
      id: eventMemoryEventId,
      userId,
      memoryId: eventMemoryId,
      icalUid: "test",
      integrationAccountId: calendarIntegrationId,
      platformAccountId: calendarPlatformAccountId,
      platformCalendarId: calendarPlatformId,
      platformId: eventPlatformId,
      calendarId: calendarId,
      source: GOOGLE_CALENDAR,
      sequence: 1,

      startDate: new Date("2025-05-22T13:30:48.512Z"),
      endDate: new Date("2025-05-22T14:30:48.512Z"),
      eventType: "default",
      attendenceStatus: "tentative",
    });

    // Insert task integration
    const taskIntegrationId = crypto.randomUUID();
    const taskPlatformAccountId = crypto.randomUUID();
    await db.insert(integrationsAccountsTable).values({
      id: taskIntegrationId,
      userId,
      integrationType: LINEAR_INTEGRATION,
      platformAccountId: taskPlatformAccountId,
      email: "test@test.com",
      platformDisplayName: "Test Integration",
      platformData: {
        workspaceId: "test",
      },
      accessToken: "test",
      refreshToken: "test",
      expiresAt: new Date(),
    });

    // Insert tasklist
    const tasklistId = crypto.randomUUID();
    const tasklistPlatformId = crypto.randomUUID();
    await db.insert(tasklistsTable).values({
      id: tasklistId,
      userId,
      integrationAccountId: taskIntegrationId,
      platformAccountId: taskPlatformAccountId,
      platformTaskListId: tasklistPlatformId,
      source: LINEAR_INTEGRATION,
      name: "Test Tasklist",
    });

    // Insert calendar event memory
    const taskMemoryId = crypto.randomUUID();
    const taskMemoryTaskId = crypto.randomUUID();
    const taskPlatformId = crypto.randomUUID();
    await db.insert(memoryTable).values({
      id: taskMemoryId,
      userId,
      source: "TASK",
      content: "Fix landing typo",
      contentEmbedding: [
        0.014081596, -0.0076438505, 0.100369215, 0.0035840098, -0.035407618,
        -0.027007358, 0.09638466, 0.054197904, 0.010815118, 0.036922105,
        0.09574947, -0.009349551, 0.0117626125, 0.007277432, -0.082589775,
        -0.0132420175, -0.044640686, -0.013359535, -0.021341132, -0.03195974,
        -0.06265278, 0.07766353, -0.019196289, 0.062430438, 0.033564482,
        -0.004555581, -0.03578284, 0.04851793, 0.0059013856, -0.10099291,
        -0.04038269, 0.15300216, 0.016883893, -0.0072845537, 0.07512609,
        0.06218214, -0.008337402, -0.02575556, 0.090802334, -0.06187386,
        -0.0077757216, -0.13741702, 0.06716757, 0.05463077, 0.06833846,
        0.0459421, -0.016282385, 0.036451012, 0.053002905, 0.08082118,
        0.053455237, -0.019612392, 0.043940637, -0.04870983, 0.035008177,
        0.077008046, -0.036594503, 0.029169746, 0.05212578, -0.0670101,
        0.086610466, 0.029421898, 0.00073299586, -0.035562187, 0.06363273,
        -0.020730112, -0.027326358, -0.15167631, -0.016787862, 0.1256172,
        0.0062505053, 0.02425267, -0.025231699, 0.063084245, -0.031573664,
        -0.00862026, 0.007596444, 0.015450489, 0.071478054, -0.03152248,
        0.03220453, -0.030222291, -0.025233025, 0.011897676, 0.08778057,
        -0.007600455, 0.014631044, -0.011052056, 0.06093367, 0.0016365579,
        -0.038623344, -0.1467584, 0.12620114, 0.021160219, -0.11308217,
        -0.008855068, -0.026976412, -0.033691652, -0.063776344, 0.08996768,
        0.029521793, 0.06605472, -0.026938299, 0.016947003, -0.09097209,
        -0.011668123, 0.004893852, 0.027658802, 0.0372979, -0.03869259,
        0.012343622, -0.047753673, 0.010554053, 0.015265739, -0.057955675,
        -0.0485073, -0.031304616, -0.034722637, -0.029598026, -0.08077789,
        -0.06656452, -0.037987985, -0.024567585, 0.02588758, -0.011443426,
        -0.14379619, 0.07398348, -1.2341761e-33, 0.0068186037, 0.093057215,
        -0.001977382, -0.056346573, 0.086263575, -0.023146769, -0.03885154,
        -0.01716959, -0.053205255, -0.02533836, -0.008985217, -0.096151784,
        0.029153332, -0.08615197, 0.002026157, 0.03643684, -0.021946749,
        -0.014558507, -0.117288165, -0.046047438, 0.058784205, 0.009183253,
        -0.05992693, -0.03368557, -0.00038530258, -0.00285274, -0.029304907,
        0.016153974, 0.024731858, 0.0027860196, 0.012865527, 0.027997186,
        0.043857202, 0.011450561, -0.02194077, -0.09635337, 0.07769343,
        -0.09300814, -0.07310627, 0.016791346, -0.024448162, 0.05493612,
        -0.0094388, 0.00450475, 0.07928873, 0.03192516, 0.0725634,
        -0.0019639588, 0.1065621, -0.03662302, -0.077114746, 0.066667415,
        0.042722583, 0.014416943, -0.0056561744, 0.004421776, -0.0041534193,
        0.016106388, 0.0022175915, -0.024597967, 0.006722019, -0.05776299,
        0.045579564, 0.015619712, -0.01584587, -0.044793867, 0.00987396,
        0.056166973, 0.049947545, -0.025321903, -0.04165794, -0.03400742,
        0.06313919, 0.07998686, -0.07677151, -0.06720677, 0.0010384137,
        -0.013673341, -0.025382837, 0.0047440147, 0.016559668, -0.014435351,
        -0.018282836, 0.0039005154, 0.029441655, -0.023109388, 0.0027777846,
        -0.053808253, 0.008470365, 0.05528024, -0.09824801, -0.013657707,
        -0.01681219, -0.025265899, -0.029192328, 8.867313e-34, -0.09373115,
        0.025348758, -0.036492195, 0.068025395, -0.08730028, -0.07073628,
        0.097367525, 0.011017252, -0.015263154, -0.00048137654, -0.026369186,
        0.07714665, -0.08420968, -0.0529158, -0.022945037, -0.026723702,
        0.011844362, 0.016398275, -0.02719835, 0.07342239, 0.0014371607,
        -0.08356543, -0.028317105, 0.05988076, 0.026556516, 0.077455305,
        0.048228685, 0.104706764, -0.114066385, 0.049247917, 0.02486824,
        0.07509122, 0.02703, 0.027855495, 0.0042757997, -0.03685394, 0.05538601,
        -0.042911105, -0.07061133, -0.018659823, 0.06592985, -0.017538613,
        0.0056174267, 0.023955945, 0.0643111, -0.030377744, -0.0077620884,
        0.024605446, 0.0652246, -0.01364404, 0.07004796, -0.053786203,
        -0.054135974, 0.020538552, 0.06657719, 0.024896447, 0.008090401,
        -0.003273643, -0.0858068, -0.0007207646, -0.0069962484, 0.011656962,
        0.021874456, 0.005696078, 0.056875136, -0.036445074, -0.047870472,
        0.1546913, -0.018319448, 0.011983089, -0.055113766, 0.002567917,
        0.032564916, -0.049774434, -0.011020117, -0.07962164, 0.017193561,
        0.07896285, 0.052215993, -0.025416357, -0.024429563, -0.051447928,
        -0.022793261, 0.048180748, -0.011961406, 0.032023493, -0.043458413,
        0.06920133, -0.030797062, 0.0059550977, 0.009249785, -0.0028734151,
        0.043292444, 0.014658947, -0.075694926, -1.3436842e-8, -0.025864433,
        0.056228213, -0.03955667, -0.02977963, 0.035017308, -0.01319707,
        -0.027021809, -0.051385466, -0.0111190025, -0.082911566, -0.06313675,
        -0.022870822, 0.006694336, 0.013479649, 0.0301069, -0.018310891,
        -0.08210939, 0.08497004, -0.11376628, -0.043383088, 0.0036612581,
        0.055862594, -0.049048617, -0.07407369, 0.010276359, 0.057081025,
        -0.02082975, 0.039076775, 0.0008076036, -0.05446241, 0.01877356,
        0.014265003, 0.03755665, -0.0033272416, 0.07079923, -0.015604827,
        0.12644584, 0.064539604, 0.049624197, 0.04241922, -0.039199714,
        0.010547717, 0.017565027, 0.009530851, -0.065294996, 0.03587568,
        0.008480653, 0.0022886577, 0.023766907, -0.084915414, 0.07470798,
        -0.006908829, 0.021596074, 0.0625816, 0.081908084, -0.027456718,
        -0.000554317, -0.044680033, 0.0019948948, 0.03433823, 0.028110601,
        0.015188256, -0.02078335, -0.0030789522,
      ],
      description:
        "There's a typo on the landing page, in the pricing section. I need to fix it.",
      descriptionEmbedding: [
        0.004168338, 0.007838455, 0.030411266, -0.0057475236, 0.013155538,
        0.004054634, -0.0021283613, 0.023786874, -0.021623494, 0.04574299,
        0.063582174, 0.03407635, -0.038952872, -0.008361301, -0.0591096,
        -0.05597924, -0.043549027, -0.061962847, 0.014415433, 0.01689076,
        -0.04928342, 0.049041845, -0.026919166, 0.07111314, 0.07753267,
        -0.015839905, -0.03347123, 0.030100472, -0.033226296, -0.056283,
        -0.08183786, 0.097232476, 0.03320975, 0.0020769134, 0.1262737,
        -0.006711475, -0.00859035, -0.030564666, 0.028795337, -0.03482683,
        0.055365197, -0.08899186, -0.04648085, 0.067045994, 0.020068143,
        -0.0044650477, -0.020936714, 0.047033172, 0.08984917, 0.08768553,
        0.05846058, 0.00025430392, 0.016987726, -0.013226699, -0.03395789,
        0.07863159, -0.011953119, 0.013385446, 0.055238444, -0.045687843,
        0.08084118, -0.008035894, -0.003481088, 0.054841414, 0.04209815,
        0.0051642717, -0.024232328, -0.1271339, -0.048012633, 0.02337184,
        0.013249668, -0.0041667204, 0.0060384856, 0.075461105, -0.01498041,
        -0.03544347, 0.06016035, -0.042043887, 0.08139883, -0.019785311,
        -0.012651057, -0.034100365, -0.040297702, -0.016174031, 0.12850995,
        -0.03214422, 0.057640895, -0.022668034, 0.07855611, -0.019906953,
        0.007240244, -0.07888546, 0.052012842, 0.031277318, -0.1384892,
        0.004651145, -0.04333766, -0.025813654, -0.012650832, 0.040006302,
        0.04485584, -0.012812417, 0.040022403, 0.05186385, -0.13016054,
        -0.052640803, -0.019983778, 0.11824574, 0.0074868114, -0.02545459,
        -0.01185676, -0.052338716, -0.021628771, 0.035981983, -0.10513793,
        -0.036191933, 0.0021085048, -0.06823613, 0.07560963, -0.07722854,
        -0.046363235, -0.044697747, -0.03526706, -0.04102545, -0.057653103,
        -0.12840094, 0.03750518, -8.426755e-33, -0.060194053, 0.09576755,
        -0.03004173, -0.11774086, 0.012911633, -0.00888346, -0.006143768,
        0.028800528, -0.06676566, 0.017893782, 0.009696336, -0.06978807,
        0.0031670916, 0.016168542, 0.014248391, -0.03390457, -0.03990531,
        0.03774238, 0.01701437, -0.02600807, 0.031386904, -0.032437023,
        -0.052353393, -0.058207378, -0.02953902, 0.08021315, -0.031151637,
        0.04098999, 0.06927386, 0.02205284, 0.015031926, 0.010725644,
        0.07569546, -0.0058454783, -0.021861354, -0.046275806, 0.031665873,
        -0.06292779, -0.05793373, -0.018439833, -0.08249411, 0.048969775,
        -0.031400274, -0.030594673, 0.01535067, 0.048053402, 0.079593904,
        -0.025853466, 0.08375, -0.011878343, -0.1509968, 0.023187859,
        0.036111373, 0.034675404, -0.01651458, -0.061969377, 0.00038274366,
        0.020087613, 0.0051158546, -0.037881818, 0.0016948776, -0.056752264,
        0.0005829483, -0.029737158, -0.025260365, 0.02311572, 0.02629723,
        0.06631893, 0.018214293, -0.05299691, -0.014653235, -0.005407234,
        0.1004422, 0.042314395, -0.06652636, -0.029245013, -0.014787293,
        0.008177445, -0.011327946, 0.06254156, -0.022848444, -0.040835354,
        0.016964432, 0.027754245, -0.009698048, -0.029798921, 0.002139138,
        0.033029277, 0.010511332, 0.05564907, -0.051048405, 0.03280553,
        -0.06246931, 0.009263818, 0.0050546527, 6.049411e-33, -0.06923547,
        -0.008064325, -0.02639857, 0.07555528, -0.071111195, -0.021639217,
        0.050836973, 0.080716774, 0.028028267, 0.011727041, -0.06080875,
        0.10380342, -0.10829555, -0.006462592, -0.031233665, -0.042174436,
        -0.054813657, -0.015871475, 0.045278948, -0.0030590761, -0.053980473,
        0.0627181, -0.009034477, 0.031583246, 0.037015762, 0.07182544,
        0.045217935, 0.08032578, -0.033625185, 0.06263682, 0.017353235,
        0.00936482, -0.04714843, 0.04750489, 0.039350744, 0.005291794,
        0.07042244, -0.054838948, -0.0061170547, -0.008701293, 0.024865724,
        -0.041928846, 0.0049645416, -0.016920514, 0.09965343, -0.054785475,
        0.09479622, -0.06424745, 0.039199416, 0.006381178, 0.031064564,
        -0.013566784, -0.004805495, 0.024564577, -0.03028024, 0.051131926,
        -0.0014152731, 0.060871515, -0.022167236, -0.06512895, 0.027855655,
        0.0933376, -0.010954986, 0.0122992825, 0.062615216, -0.024407445,
        0.021487523, 0.09863813, 0.0021744003, 0.013309617, -0.117442854,
        -0.029986968, 0.078352705, -0.08371744, -0.026446832, -0.05203288,
        0.04880662, 0.06534952, 0.10514807, -0.021860788, 0.043533895,
        0.0026038457, -0.010533821, 0.03762056, 0.0050724936, -0.063851394,
        -0.04809077, 0.046817366, -0.07706242, 0.0580573, -0.0842882,
        -0.016234683, 0.020263705, 0.08970746, -0.11584182, -2.421312e-8,
        0.028813992, 0.07169855, 0.020348808, -0.009822321, 0.05324827,
        -0.050599527, 0.04655522, -0.015860595, -0.009140471, 0.0023604175,
        -0.005000735, -0.05008215, 0.007001454, 0.01970465, -0.020229515,
        -0.053941894, -0.14948615, 0.1271414, -0.05904263, -0.07683505,
        -0.014239797, 0.080912896, -0.015745264, -0.09217547, -0.005513258,
        0.08014517, -0.0149887465, 0.07337872, -0.0035079753, -0.07178951,
        -0.0712315, 0.045286957, 0.08887129, -0.0013413692, 0.0729847,
        -0.03172374, 0.0100021325, 0.091714375, 0.025582548, -0.020849375,
        -0.040513836, 0.006796446, -0.031541474, 0.032088883, 0.022737944,
        0.084705345, -0.103543244, 0.005474491, 0.01945428, -0.051019456,
        0.036019433, 0.006981134, 0.028347014, 0.04265807, 0.011075065,
        -0.05369783, 0.015914394, -0.06678812, 0.010810194, 0.034211125,
        0.039853636, -0.058180265, -0.018776339, 0.031496476,
      ],
      createdAt: new Date(),
      lastUpdate: new Date(),
    });
    await db.insert(memoryTaskTable).values({
      id: taskMemoryTaskId,
      userId,
      memoryId: taskMemoryId,
      tasklistId: tasklistId,
      integrationAccountId: taskIntegrationId,
      platformAccountId: taskPlatformAccountId,
      platformTaskListId: tasklistPlatformId,
      platformTaskId: taskPlatformId,
      source: LINEAR_INTEGRATION,
      dueDate: new Date("2025-05-22T13:30:48.512Z"),
    });
  }, 90000);

  afterAll(async () => {
    await databaseContainer?.stop();
  });

  describe("getMemories", () => {
    it("get empty memories", async () => {
      const memories = await getMemories(userId, []);
      expect(memories.length).toBe(0);
    });
  });
});
